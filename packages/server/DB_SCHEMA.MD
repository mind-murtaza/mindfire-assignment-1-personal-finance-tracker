# ðŸ“„ Users Collection Schema

## Purpose
Stores user identity, credentials, and application settings.

## Indexes
- `{ email: 1 }` (unique, background)
- `{ status: 1 }` (background)
- `{ status: 1, lastLoginAt: -1 }` (compound, background)

## Schema Definition
```javascript
const UserSchema = {
  _id: ObjectId, // MongoDB ObjectId
  email: String, // Indexed, Unique, Required, Lowercased
  password: String, // Hashed, Required, Not selected by default

  profile: {
    firstName: String, // Required, Only letters
    lastName: String, // Required, Only letters
    avatarUrl: String, // Optional, URL to user's avatar image
    mobileNumber: String, // Optional, 10-digit format
  },

  settings: {
    mobileDialCode: String, // Default: '+91', Validated against known dial codes
    currency: String, // Default: 'INR', ISO 4217 currency codes
    theme: String, // Default: 'system', Enum: ['system', 'light', 'dark']
  },

  status: String, // Required, Enum: ['active', 'suspended', 'pending_verification', 'deleted']

  lastLoginAt: Date, // Nullable, Tracks last login time
  createdAt: Date, // Auto-generated by Mongoose
  updatedAt: Date, // Auto-generated by Mongoose
};
```

## Validation Rules
- **Email**: Must be a valid email format, lowercased, and unique.
- **Password**: Must be at least 8 characters, include uppercase, lowercase, number, and special character.
- **First Name & Last Name**: Only letters, max 50 characters.
- **Mobile Number**: 10-digit format.
- **Mobile Dial Code**: Must be a valid dial code.
- **Currency**: Must be a valid ISO 4217 code.
- **Theme**: Must be one of 'system', 'light', or 'dark'.
- **Status**: Must be one of 'active', 'suspended', 'pending_verification', or 'deleted'.

## Security & Performance
- Passwords are hashed using bcrypt before saving.
- Sensitive fields like password are not selected by default in queries.
- Indexes are created in the background to avoid blocking operations.
- Compound indexes optimize common query patterns for performance.


# ðŸ“„ Categories Collection Schema

## Purpose
Stores user-defined and default categories for transactions.

## Indexes
- `{ userId: 1, type: 1 }` (background)
- `{ userId: 1, isDeleted: 1 }` (background)
- `{ userId: 1, type: 1, isDefault: 1 }` (unique, background, partialFilterExpression: { isDefault: true })

## Schema Definition
```javascript
const CategorySchema = {
  _id: ObjectId, // MongoDB ObjectId
  userId: { type: ObjectId, ref: 'User', required: true, index: true },
  name: { type: String, required: true, trim: true },

  type: {
    type: String,
    enum: ['income', 'expense'],
    required: true
  },

  parentId: { type: ObjectId, ref: 'Category', default: null }, // For sub-categories
  color: { type: String, default: '#CCCCCC' }, // Hex color for UI
  icon: { type: String, default: 'tag' }, // Icon identifier (e.g., from lucide-react)

  isDefault: { type: Boolean, default: false }, // System-provided categories
  monthlyBudget: { type: mongoose.Schema.Types.Decimal128, default: 0.00 },

  // Soft delete fields
  isDeleted: { type: Boolean, default: false, index: true },
  deletedAt: { type: Date, default: null },

  createdAt: Date, // Auto-generated by Mongoose
  updatedAt: Date, // Auto-generated by Mongoose
};
```

## Validation Rules
- **Name**: Required, trimmed, max 50 characters.
- **Type**: Must be one of 'income' or 'expense'.
- **Color**: Must be a valid hex color code.
- **Icon**: Must be lowercase letters and hyphens only, max 30 characters.
- **Monthly Budget**: Must be a positive number with at most 2 decimal places.

## Business Logic
- **Default Category**: Only one default category per user and type (income/expense) is allowed, enforced by a unique index.
- **Parent-Child Relationship**: Categories can have sub-categories, but cannot be their own parent or create circular references.
- **Soft Delete**: Categories can be soft-deleted, retaining their data but marked as inactive.

## Security & Performance
- **Indexes**: Ensure fast queries and enforce unique constraints.
- **Atomic Operations**: Default category logic uses MongoDB transactions for consistency.
- **Zod Validation**: All field-level validation is handled by Zod schemas in the pre-save hook.
